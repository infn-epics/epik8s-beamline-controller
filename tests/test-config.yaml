# Beamline Controller Configuration
# This file defines the tasks to run and their configurations

prefix: "SPARC:CONTROL2"
tasksrepo: "https://github.com/infn-epics/sparc-beamline-controller-tasks.git"
tasksrev: "main"

# List of tasks to execute
tasks:
  # Example monitoring task
  - name: "monitor_01"
    module: "monitoring_task" # Python module name in tasks/ directory
    parameters:
      update_rate: 2.0 # Hz
      calculation_type: "average" # average, sum, max, min
    pvs:
      inputs:
        INPUT1:
          type: float
          value: 0.0
          unit: "V"
          prec: 3
          low: -10.0
          high: 10.0
        INPUT2:
          type: float
          value: 0.0
          unit: "V"
          prec: 3
          low: -10.0
          high: 10.0
        INPUT3:
          type: float
          value: 0.0
          unit: "V"
          prec: 3
          low: -10.0
          high: 10.0
        RESET:
          type: int
          value: 0
      outputs:
        OUTPUT_RESULT:
          type: float
          value: 0.0
          unit: "V"
          prec: 3
        SAMPLE_COUNT:
          type: int
          value: 0

  # Example data logging task
  # - name: "logger_01"
  #   module: "data_logging_task"
  #   parameters:
  #     log_interval: 10.0  # seconds
  #     log_directory: "./logs"
  #     log_format: "csv"  # csv or txt
  #   pvs:
  #     inputs:
  #       VALUE1:
  #         type: float
  #         value: 0.0
  #         unit: "A"
  #         prec: 4
  #       VALUE2:
  #         type: float
  #         value: 0.0
  #         unit: "A"
  #         prec: 4
  #       VALUE3:
  #         type: float
  #         value: 0.0
  #         unit: "A"
  #         prec: 4
  #       RESET_COUNT:
  #         type: int
  #         value: 0
  #     outputs:
  #       LOG_COUNT:
  #         type: int
  #         value: 0
  #       LAST_LOG_TIME:
  #         type: string
  #         value: "Never"

  # You can add more tasks here following the same pattern
  # - name: "your_task_name"
  #   module: "your_task_module"
  #   parameters:
  #     param1: value1
  #     param2: value2
  #   pvs:
  #     inputs:
  #       INPUT_PV_NAME:
  #         type: float
  #         value: 0.0
  #     outputs:
  #       OUTPUT_PV_NAME:
  #         type: float
  #         value: 0.0

  # Example motor control task using Ophyd devices
  - name: "check_motor_movement"
    module: "check_motor_movement"
    parameters:
      update_rate: 2.0 # Hz
      # List of motor device names from values.yaml IOCs
      # Format: "ioc_name" or "ioc_name_device_name" for multi-device IOCs
      motors:
        - "GUNFLG01"
        - "AC1FLG01"
        - "AC2FLG01"
        - "AC3FLG01"
        - "UTLFLG01"
        - "UTLFLG02"
        - "SBNFLG00"
        - "SBNFLG01"
        - "GUNSOLH1"
        - "GUNSOLV1"
        - "CMBROH01"
        - "CMBEOS01"
        - "CMBTHV01"
        - "CMBPQH02"
        - "CMBPQH01"
        - "CMBPQV01"
        - "CMBPQV02"
        - "CMBPLV01"
        - "CMBROV01"
        - "CMBTHR01"
        - "CMBTRH01"

      switchoff:
        - "CATLAS01"
        - "EOSLAS01"

    pvs:
      outputs:
        MOVING:
          type: bool
          value: 0
          znam: "Stopped"
          onam: "Moving"

  # IOC Management Task - Monitors ArgoCD applications
  - name: "ioc_manager"
    module: "iocmng_task"
    parameters:
      update_rate: 0.1 # Hz (every 10 seconds)
      argocd_namespace: "argocd"
      archiver_url: "http://sparc-archiver.k8sda.lnf.infn.it"
      archiver_threshold_restart: 10  # Threshold to restart archiver if connected below this value
      archiver_wait_restart_min: 5    # wait before restarting archiver (minutes)